<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andrew's English | Online Classroom</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a73e8; --success: #38a169; --error: #e53e3e; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 750px; }
        .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee; margin-bottom: 20px; }
        .school-header { text-align: center; margin-bottom: 30px; }
        .school-logo { max-width: 180px; height: auto; margin-bottom: 15px; border-radius: 8px; }
        .school-name { color: var(--primary); margin: 0; font-size: 2.2rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .lang-ch { display: block; color: #666; font-size: 1rem; font-weight: normal; margin-top: 4px; }
        
        /* Rule Table Styles */
        .rule-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.95rem; }
        .rule-table th, .rule-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .rule-table th { background-color: #f1f3f4; color: var(--primary); }
        .example-box { background: #fffde7; padding: 10px; border-radius: 4px; border-left: 4px solid #fbc02d; margin-top: 5px; font-style: italic; }

        input[type="text"] { width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; margin-bottom: 20px; }
        button { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.2s; }
        button:hover { filter: brightness(0.9); }
        .report-row { padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid; }
        .report-row.correct { background: #e6fffa; border-color: var(--success); }
        .report-row.incorrect { background: #fff5f5; border-color: var(--error); }
        .strike { text-decoration: line-through; color: var(--error); margin-right: 10px; }
        .fixed { color: var(--success); font-weight: bold; }
        .audio-btn { width: auto; padding: 8px 15px; background: #e8f0fe; color: var(--primary); font-size: 0.85rem; margin-bottom: 15px; border-radius: 20px; border:none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin: 0 auto 15px auto; }
        @media print { .no-print { display: none; } body { padding: 0; } .card { box-shadow: none; border: none; } }
    </style>
</head>
<body>

<div class="app-container">
    <header class="school-header">
        <img src="logo.png" alt="Andrew's English Logo" class="school-logo" onerror="this.style.display='none'">
        <h1 class="school-name">Andrew's English</h1>
        <p class="lang-ch">Online Grammar Classroom | ç·šä¸Šèªæ³•æ•™å®¤</p>
    </header>

    <div id="login-card" class="card">
        <h2 style="text-align:center;">Student Portal <span class="lang-ch" style="font-size: 0.9rem;">å­¸ç”Ÿç™»å…¥</span></h2>
        <input type="text" id="student-name" placeholder="Enter your full name">
        <button onclick="goToMenu()">Enter Classroom / é€²å…¥æ•™å®¤</button>
    </div>

    <div id="menu-card" class="card" style="display:none;">
        <h3 id="welcome-msg" style="color: var(--primary); text-align: center;"></h3>
        <h2 style="margin-top:0; text-align: center;">Select a Lesson <span class="lang-ch" style="font-size: 0.9rem;">é¸æ“‡èª²ç¨‹</span></h2>
        <button onclick="loadTense('present')">Present Simple / ç¾åœ¨ç°¡å–®å¼</button>
        <button onclick="loadTense('past')">Past Simple / éå»ç°¡å–®å¼</button>
        <button onclick="loadTense('future')">Future Simple / æœªä¾†ç°¡å–®å¼</button>
    </div>

    <div id="rule-card" class="card" style="display:none;">
        <div id="rule-content"></div>
        <button onclick="startQuiz()">Start Quiz / é–‹å§‹æ¸¬é©—</button>
        <button style="background:#666;" onclick="backToMenu()">Back to Lessons / è¿”å›èª²ç¨‹</button>
    </div>

    <div id="quiz-container" class="card" style="display:none;">
        <div id="question-area"></div>
    </div>

    <div id="results-container" class="card" style="display:none;">
        <h2 id="result-title">Quiz Results</h2>
        <div id="score-summary"></div>
        <div id="report-list"></div>
        <button class="no-print" onclick="window.print()">Download PDF Report / ä¸‹è¼‰å ±å‘Š</button>
        <button style="background: var(--success);" class="no-print" onclick="backToMenu()">Try Another Lesson / é¸æ“‡å…¶ä»–èª²ç¨‹</button>
        <button style="background:#666;" class="no-print" onclick="location.reload()">Logout / ç™»å‡º</button>
    </div>
</div>

<script>
    var studentName = "";
    var currentTense = "";
    var currentIdx = 0;
    var studentAnswers = [];
    
    var data = {
        present: {
            title: "Present Simple ç¾åœ¨ç°¡å–®å¼",
            rule: "Habits and general facts. <br>ç”¨æ–¼ç¿’æ…£èˆ‡æ™®éäº‹å¯¦ã€‚",
            table: `
                <table class="rule-table">
                    <tr><th>Subject (ä¸»è©)</th><th>Rule (è¦å‰‡)</th></tr>
                    <tr><td>I / You / We / They</td><td>Base Verb (åŸå½¢å‹•è©) <div class="example-box">I <b>eat</b> apples.</div></td></tr>
                    <tr><td>He / She / It</td><td>Verb + <b>-s / -es</b> <div class="example-box">She <b>eats</b> apples.</div></td></tr>
                    <tr><td>Negative (å¦å®š)</td><td>don't / doesn't + Verb <div class="example-box">He <b>doesn't like</b> coffee.</div></td></tr>
                </table>`,
            questions: [
                { q: "She ___ (eat) an apple every morning.", a: "eats" },
                { q: "They ___ (not like) cold weather.", a: "do not like" },
                { q: "He ___ (play) the piano very well.", a: "plays" },
                { q: "I ___ (not drink) coffee in the evening.", a: "do not drink" },
                { q: "The sun ___ (rise) in the east.", a: "rises" },
                { q: "We ___ (not watch) TV on weekdays.", a: "do not watch" },
                { q: "My cat ___ (sleep) on the sofa.", a: "sleeps" },
                { q: "You ___ (not speak) Spanish fluently.", a: "do not speak" },
                { q: "It ___ (rain) a lot in April.", a: "rains" },
                { q: "Birds ___ (not fly) south in the summer.", a: "do not fly" }
            ]
        },
        past: {
            title: "Past Simple éå»ç°¡å–®å¼",
            rule: "Finished actions in the past. <br>ç”¨æ–¼éå»å·²å®Œæˆçš„å‹•ä½œã€‚",
            table: `
                <table class="rule-table">
                    <tr><th>Subject (ä¸»è©)</th><th>Rule (è¦å‰‡)</th></tr>
                    <tr><td>All Subjects</td><td>Verb + <b>-ed</b> (or Irregular) <div class="example-box">I <b>visited</b> London. / He <b>bought</b> a car.</div></td></tr>
                    <tr><td>Negative (å¦å®š)</td><td><b>did not</b> + Base Verb <div class="example-box">They <b>did not go</b> to school.</div></td></tr>
                </table>`,
            questions: [
                { q: "We ___ (visit) the museum yesterday.", a: "visited" },
                { q: "I ___ (not see) the movie last night.", a: "did not see" },
                { q: "He ___ (buy) a new bike last week.", a: "bought" },
                { q: "They ___ (not go) to the party.", a: "did not go" },
                { q: "She ___ (finish) her homework early.", a: "finished" },
                { q: "You ___ (not call) me on my birthday.", a: "did not call" },
                { q: "The dog ___ (bark) at the mailman.", a: "barked" },
                { q: "It ___ (not snow) last winter.", a: "did not snow" },
                { q: "We ___ (eat) pizza for dinner.", a: "ate" },
                { q: "He ___ (not lose) his keys.", a: "did not lose" }
            ]
        },
        future: {
            title: "Future Simple æœªä¾†ç°¡å–®å¼",
            rule: "Actions that will happen later. <br>ç”¨æ–¼å³å°‡ç™¼ç”Ÿçš„å‹•ä½œã€‚",
            table: `
                <table class="rule-table">
                    <tr><th>Subject (ä¸»è©)</th><th>Rule (è¦å‰‡)</th></tr>
                    <tr><td>All Subjects</td><td><b>will</b> + Base Verb <div class="example-box">I <b>will help</b> you.</div></td></tr>
                    <tr><td>Negative (å¦å®š)</td><td><b>will not (won't)</b> + Base Verb <div class="example-box">She <b>will not forget</b>.</div></td></tr>
                </table>`,
            questions: [
                { q: "I ___ (help) you with your bags.", a: "will help" },
                { q: "She ___ (not forget) her umbrella.", a: "will not forget" },
                { q: "They ___ (arrive) at 6 PM.", a: "will arrive" },
                { q: "We ___ (not stay) late at the park.", a: "will not stay" },
                { q: "You ___ (enjoy) the concert tonight.", a: "will enjoy" },
                { q: "He ___ (not eat) the spicy soup.", a: "will not eat" },
                { q: "It ___ (be) sunny tomorrow.", a: "will be" },
                { q: "I ___ (not wear) a coat today.", a: "will not wear" },
                { q: "The bus ___ (stop) here soon.", a: "will stop" },
                { q: "They ___ (not play) outside if it rains.", a: "will not play" }
            ]
        }
    };

    function goToMenu() {
        var nameInput = document.getElementById('student-name').value;
        if(!nameInput.trim()) { alert("Please enter your name / è«‹è¼¸å…¥å§“å"); return; }
        studentName = nameInput.trim();
        document.getElementById('login-card').style.display = 'none';
        document.getElementById('menu-card').style.display = 'block';
        document.getElementById('welcome-msg').innerText = "Student: " + studentName;
    }

    function backToMenu() {
        currentIdx = 0;
        studentAnswers = [];
        document.getElementById('rule-card').style.display = 'none';
        document.getElementById('results-container').style.display = 'none';
        document.getElementById('menu-card').style.display = 'block';
    }

    function loadTense(tense) {
        currentTense = tense;
        document.getElementById('menu-card').style.display = 'none';
        document.getElementById('rule-card').style.display = 'block';
        document.getElementById('rule-content').innerHTML = `
            <h2 style="color:var(--primary); text-align:center;">${data[tense].title}</h2>
            <p style="text-align:center; font-weight:600;">${data[tense].rule}</p>
            ${data[tense].table}
        `;
    }

    function startQuiz() {
        document.getElementById('rule-card').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        showQuestion();
    }

    function playAudio(text) {
        var msg = new SpeechSynthesisUtterance();
        msg.text = text.replace("___", "blank");
        msg.lang = 'en-US';
        window.speechSynthesis.speak(msg);
    }

    function showQuestion() {
        var item = data[currentTense].questions[currentIdx];
        document.getElementById('question-area').innerHTML = `
            <button class="audio-btn" onclick="playAudio('${item.q.replace(/'/g, "\\'")}')">ğŸ”ˆ Listen / è½è®€</button>
            <p style="text-align:center; color:#666;">Question ${currentIdx + 1} of 10</p>
            <h3 style="text-align:center; margin: 20px 0;">${item.q}</h3>
            <input type="text" id="user-input" autocomplete="off" onkeypress="if(event.key==='Enter') next()">
            <button onclick="next()">Submit Answer / æäº¤</button>
        `;
        document.getElementById('user-input').focus();
    }

    function next() {
        var val = document.getElementById('user-input').value;
        studentAnswers.push(val);
        currentIdx++;
        if (currentIdx < 10) showQuestion(); else showResults();
    }

    function normalize(text) {
        if (!text) return "";
        var n = text.toLowerCase().trim();
        n = n.replace(/[â€™']/g, "'");
        n = n.replace("don't", "do not").replace("doesn't", "does not").replace("didn't", "did not").replace("won't", "will not").replace("can't", "cannot").replace("i'm", "i am");
        n = n.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
        return n.replace(/\s+/g, ' ');
    }

    function showResults() {
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('results-container').style.display = 'block';
        var score = 0;
        var html = "";
        for (var i = 0; i < data[currentTense].questions.length; i++) {
            var q = data[currentTense].questions[i];
            var isCorrect = normalize(studentAnswers[i]) === normalize(q.a);
            if(isCorrect) score++;
            html += `<div class="report-row ${isCorrect ? 'correct' : 'incorrect'}">
                <strong>${q.q}</strong><br>
                ${isCorrect ? 'âœ“ ' + studentAnswers[i] : '<span class="strike">' + (studentAnswers[i] || "No Answer") + '</span> <span class="fixed">' + q.a + '</span>'}
            </div>`;
        }
        document.
