<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andrew's English | 9-Tense Mastery</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #1a73e8; --success: #2d8a57; --error: #c53030; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 850px; position: relative; padding-bottom: 100px; }
        .school-header { text-align: center; margin-bottom: 20px; }
        .school-logo { max-width: 280px; height: auto; border-radius: 10px; }
        .card { background: white; padding: 35px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee; margin-bottom: 20px; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .lesson-btn { padding: 18px; border: none; background: var(--primary); color: white; border-radius: 12px; cursor: pointer; font-weight: 700; transition: 0.3s; font-size: 0.95rem; }
        .lesson-btn:hover { background: #1557b0; transform: translateY(-2px); }
        .nav-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 850px; display: flex; justify-content: space-between; z-index: 1000; }
        .home-btn { background: #444; color: white; border: none; padding: 12px 25px; border-radius: 30px; cursor: pointer; font-weight: bold; }
        .prev-btn-nav { background: white; color: #444; border: 1px solid #ddd; padding: 12px 25px; border-radius: 30px; cursor: pointer; visibility: hidden; font-weight: bold; }
        .tense-header-bar { background: var(--primary); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; font-weight: bold; font-size: 1.2rem; }
        .rule-table { width: 100%; border-collapse: collapse; margin: 15px 0; background: #fff; }
        .rule-table th, .rule-table td { border: 1px solid #dfe1e5; padding: 12px; text-align: left; }
        .rule-table th { background: #f8f9fa; color: var(--primary); }
        input[type="text"] { width: 100%; padding: 18px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 20px; box-sizing: border-box; }
        #rules-modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); }
        .modal-content { background: white; margin: 5% auto; padding: 30px; width: 90%; max-width: 600px; border-radius: 20px; position: relative; max-height: 85vh; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .close-modal { position: absolute; right: 20px; top: 15px; font-size: 30px; cursor: pointer; color: #666; }
        .review-item { border-bottom: 1px solid #eee; padding: 15px 0; font-size: 0.95rem; }
        .correct-ans { color: var(--success); font-weight: bold; }
        .wrong-ans { color: var(--error); text-decoration: line-through; margin-right: 10px; }
        /* ... other existing CSS ... */

#capture-area {
    background: white;
    padding: 20px;
    border-radius: 10px;
    color: #333;
}

</style> ```

---

### Why this is important for your PDF:
When JavaScript "takes a picture" of your results to put into the PDF, it needs a solid background. If you don't define the background as `white`, the PDF might come out with a black or transparent background, making the text impossible to read.

### Updated PDF Patch (All-in-One)
Since you are updating this, here is the corrected **Results Section** with the logo and the capture area together. This ensures the logo appears at the top of the PDF:

```html
<div id="results-container" class="card" style="display:none;">
    <div id="capture-area">
        <div style="text-align: center; margin-bottom: 10px;">
            <img src="your-logo-filename.png" style="max-width: 150px;">
        </div>
        
        <h2 style="text-align:center; margin-top: 0;">Performance Report</h2>
        <div id="score-summary" style="text-align:center; border: 3px dashed #e1e4e8; padding: 30px; margin-bottom: 25px; border-radius: 15px;"></div>
    </div>
    
    <button style="background:#ff9800; color:white; width:100%; padding:18px; border:none; border-radius:10px; cursor:pointer; font-weight: bold; margin-bottom:20px;" 
            onclick="saveAsPDF()">
        ğŸ“„ Save Result as PDF
    </button>
    
    <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">Answer Review:</h3>
    <div id="review-list"></div>
</div>
    </style>
</head>
<body>

<div id="rules-modal"><div class="modal-content"><span class="close-modal" onclick="toggleModal(false)">&times;</span><div id="modal-body"></div></div></div>

<div class="app-container">
    <header class="school-header">
        <h1 style="color: var(--primary); margin-bottom: 5px;">Andrew's English</h1>
        <p style="color: #666; margin-top: 0;">Online Learning Portal</p>
    </header>

    <div id="login-card" class="card">
        <h2 style="text-align:center; margin-top: 0;">Student Login <span style="font-size: 0.8rem; color:#888; display: block;">è«‹è¼¸å…¥å§“åç™»å…¥</span></h2>
        <input type="text" id="student-name" placeholder="Your Name (e.g. Andrew)">
        <button style="width:100%; background:var(--primary); color:white; padding:18px; border-radius:10px; border:none; font-weight:bold; cursor:pointer; font-size: 1.1rem;" onclick="goToMenu()">Enter Classroom</button>
    </div>

    <div id="menu-card" class="card" style="display:none;">
        <h3 id="welcome-msg" style="color: var(--primary); text-align: center; margin-top: 0;"></h3>
        <p style="text-align: center; color: #666;">Select a tense to start your practice:</p>
        <div class="menu-grid" id="menu-buttons"></div>
    </div>

    <div id="rule-card" class="card" style="display:none;">
        <div id="rule-content"></div>
        <button style="width:100%; background: var(--success); color:white; padding:18px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; font-size: 1.1rem; margin-top: 20px;" onclick="startQuiz()">I'm Ready - Start Quiz!</button>
    </div>

    <div id="quiz-container" class="card" style="display:none;">
        <div id="current-tense-display" class="tense-header-bar"></div>
        <div id="question-area"></div>
    </div>

    <div id="results-container" class="card" style="display:none;">
        <button style="background:#ff9800; color:white; width:100%; padding:18px; border:none; border-radius:10px; cursor:pointer; font-weight: bold; margin-bottom:20px;" 
        onclick="saveAsPDF()">
    ğŸ“„ Save Result as PDF
</button>
            <h2 style="text-align:center; margin-top: 0;">Performance Report</h2>
            <div id="score-summary" style="text-align:center; border: 3px dashed #e1e4e8; padding: 30px; margin-bottom: 25px; border-radius: 15px;"></div>
        </div>
        <button style="background:#ff9800; color:white; width:100%; padding:18px; border:none; border-radius:10px; cursor:pointer; font-weight: bold; margin-bottom:20px;" onclick="saveAsJpeg()">ğŸ“¸ Save Result to Phone</button>
        <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">Answer Review:</h3>
        <div id="review-list"></div>
    </div>

    <div id="global-nav" class="nav-container" style="display:none;">
        <button class="home-btn" onclick="backToHome()">ğŸ  Home Menu</button>
        <button id="prev-btn" class="prev-btn-nav" onclick="prevQuestion()">â¬… Previous</button>
    </div>
</div>

<script>
    let studentName = "";
    let currentTense = "";
    let currentIdx = 0;
    let userAnswers = [];

    const data = {
        presentSimple: {
            title: "Present Simple ç¾åœ¨ç°¡å–®å¼", usage: "Habits and general truths.",
            table: `<table class="rule-table"><tr><th>I/You/We/They</th><td>Base Verb (eat)</td></tr><tr><th>He/She/It</th><td>Verb + s/es (eats)</td></tr></table>`,
            contractions: ["do not â†’ don't", "does not â†’ doesn't"],
            questions: [
                {q: "He ___ (drink) milk every morning.", a: "drinks", t: "ä»–æ¯å¤©æ—©ä¸Šå–ç‰›å¥¶ã€‚"}, {q: "They ___ (not like) apples.", a: "do not like", t: "ä»–å€‘ä¸å–œæ­¡è˜‹æœã€‚"},
                {q: "She ___ (study) English daily.", a: "studies", t: "å¥¹æ¯å¤©å­¸è‹±æ–‡ã€‚"}, {q: "I ___ (not play) soccer.", a: "do not play", t: "æˆ‘ä¸è¸¢è¶³çƒã€‚"},
                {q: "The cat ___ (sleep) on the sofa.", a: "sleeps", t: "é‚£éš»è²“ç¡åœ¨æ²™ç™¼ä¸Šã€‚"}, {q: "Water ___ (boil) at 100Â°C.", a: "boils", t: "æ°´åœ¨100åº¦æ²¸é¨°ã€‚"},
                {q: "We ___ (not live) in London.", a: "do not live", t: "æˆ‘å€‘ä¸ä½åœ¨å€«æ•¦ã€‚"}, {q: "He ___ (wash) his car weekly.", a: "washes", t: "ä»–æ¯é€±æ´—è»Šã€‚"},
                {q: "You ___ (not speak) French.", a: "do not speak", t: "ä½ ä¸èªªæ³•èªã€‚"}, {q: "The sun ___ (rise) in the east.", a: "rises", t: "å¤ªé™½å¾æ±æ–¹å‡èµ·ã€‚"}
            ]
        },
        pastSimple: {
            title: "Past Simple éå»ç°¡å–®å¼", usage: "Completed actions in the past.",
            table: `<table class="rule-table"><tr><th>Affirmative</th><td>Past Verb (V2)</td></tr><tr><th>Negative</th><td>did not + Base Verb</td></tr></table>`,
            contractions: ["did not â†’ didn't"],
            questions: [
                {q: "I ___ (visit) Japan last year.", a: "visited", t: "æˆ‘å»å¹´å»äº†æ—¥æœ¬ã€‚"}, {q: "They ___ (not go) to school yesterday.", a: "did not go", t: "ä»–å€‘æ˜¨å¤©æ²’å»å­¸æ ¡ã€‚"},
                {q: "She ___ (see) a movie last night.", a: "saw", t: "å¥¹æ˜¨æ™šçœ‹äº†é›»å½±ã€‚"}, {q: "He ___ (not eat) lunch.", a: "did not eat", t: "ä»–æ²’åƒåˆé¤ã€‚"},
                {q: "We ___ (play) tennis on Sunday.", a: "played", t: "æˆ‘å€‘é€±æ—¥æ‰“äº†ç¶²çƒã€‚"}, {q: "I ___ (buy) a new phone.", a: "bought", t: "æˆ‘è²·äº†æ–°æ‰‹æ©Ÿã€‚"},
                {q: "You ___ (not call) me.", a: "did not call", t: "ä½ æ²’æ‰“çµ¦æˆ‘ã€‚"}, {q: "It ___ (rain) all day yesterday.", a: "rained", t: "æ˜¨å¤©ä¸‹ä¸€æ•´å¤©é›¨ã€‚"},
                {q: "They ___ (finish) the game early.", a: "finished", t: "ä»–å€‘å¾ˆæ—©çµæŸéŠæˆ²ã€‚"}, {q: "She ___ (lose) her keys.", a: "lost", t: "å¥¹å¼„ä¸Ÿäº†é‘°åŒ™ã€‚"}
            ]
        },
        futureSimple: {
            title: "Future Simple æœªä¾†ç°¡å–®å¼", usage: "Future plans and predictions.",
            table: `<table class="rule-table"><tr><th>Affirmative</th><td>will + Base Verb</td></tr><tr><th>Negative</th><td>will not + Base Verb</td></tr></table>`,
            contractions: ["will not â†’ won't", "I will â†’ I'll"],
            questions: [
                {q: "I ___ (help) you tomorrow.", a: "will help", t: "æˆ‘æ˜å¤©æœƒå¹«ä½ ã€‚"}, {q: "They ___ (not come) to the party.", a: "will not come", t: "ä»–å€‘ä¸æœƒä¾†æ´¾å°ã€‚"},
                {q: "She ___ (travel) to Paris.", a: "will travel", t: "å¥¹æœƒå»å·´é»æ—…è¡Œã€‚"}, {q: "We ___ (not forget) you.", a: "will not forget", t: "æˆ‘å€‘ä¸æœƒå¿˜è¨˜ä½ ã€‚"},
                {q: "He ___ (buy) a house next year.", a: "will buy", t: "ä»–æ˜å¹´æœƒè²·æˆ¿ã€‚"}, {q: "It ___ (be) sunny tomorrow.", a: "will be", t: "æ˜å¤©æœƒæ˜¯æ™´å¤©ã€‚"},
                {q: "You ___ (love) this movie.", a: "will love", t: "ä½ æœƒå–œæ­¡é€™éƒ¨é›»å½±ã€‚"}, {q: "I ___ (not watch) TV tonight.", a: "will not watch", t: "æˆ‘ä»Šæ™šä¸çœ‹é›»è¦–ã€‚"},
                {q: "They ___ (win) the match.", a: "will win", t: "ä»–å€‘æœƒè´å¾—æ¯”è³½ã€‚"}, {q: "She ___ (not call) back.", a: "will not call", t: "å¥¹ä¸æœƒå›é›»ã€‚"}
            ]
        },
        presentContinuous: {
            title: "Present Continuous ç¾åœ¨é€²è¡Œå¼", usage: "Happening right now.",
            table: `<table class="rule-table"><tr><th>I am</th><td>Verb + ing</td></tr><tr><th>He/She/It is</th><td>Verb + ing</td></tr><tr><th>You/We/They are</th><td>Verb + ing</td></tr></table>`,
            contractions: ["is not â†’ isn't", "are not â†’ aren't", "I am â†’ I'm"],
            questions: [
                {q: "I ___ (read) a book now.", a: "am reading", t: "æˆ‘ç¾åœ¨æ­£åœ¨çœ‹æ›¸ã€‚"}, {q: "They ___ (not dance) right now.", a: "are not dancing", t: "ä»–å€‘ç¾åœ¨æ²’åœ¨è·³èˆã€‚"},
                {q: "She ___ (cook) dinner.", a: "is cooking", t: "å¥¹æ­£åœ¨ç…®æ™šé¤ã€‚"}, {q: "We ___ (not watch) TV.", a: "are not watching", t: "æˆ‘å€‘æ²’åœ¨çœ‹é›»è¦–ã€‚"},
                {q: "You ___ (listen) to music.", a: "are listening", t: "ä½ æ­£åœ¨è½éŸ³æ¨‚ã€‚"}, {q: "He ___ (not work) today.", a: "is not working", t: "ä»–ä»Šå¤©æ²’å·¥ä½œã€‚"},
                {q: "The dog ___ (bark) loudly.", a: "is barking", t: "é‚£éš»ç‹—åœ¨å¤§è²å«ã€‚"}, {q: "I ___ (not cry) anymore.", a: "am not crying", t: "æˆ‘ä¸å†å“­äº†ã€‚"},
                {q: "They ___ (play) in the park.", a: "are playing", t: "ä»–å€‘æ­£åœ¨å…¬åœ’ç©ã€‚"}, {q: "It ___ (get) dark outside.", a: "is getting", t: "å¤–é¢å¤©é»‘äº†ã€‚"}
            ]
        },
        pastContinuous: {
            title: "Past Continuous éå»é€²è¡Œå¼", usage: "Action in progress at a past time.",
            table: `<table class="rule-table"><tr><th>I/He/She/It</th><td>was + ing</td></tr><tr><th>You/We/They</th><td>were + ing</td></tr></table>`,
            contractions: ["was not â†’ wasn't", "were not â†’ weren't"],
            questions: [
                {q: "I ___ (eat) dinner at 7 PM.", a: "was eating", t: "æˆ‘ä¸ƒé»æ™‚æ­£åœ¨åƒæ™šé¤ã€‚"}, {q: "They ___ (not study) at noon.", a: "were not studying", t: "ä»–å€‘ä¸­åˆæ²’åœ¨è®€æ›¸ã€‚"},
                {q: "She ___ (sleep) when you called.", a: "was sleeping", t: "ä½ æ‰“ä¾†æ™‚å¥¹æ­£åœ¨ç¡ã€‚"}, {q: "We ___ (walk) in the park.", a: "were walking", t: "æˆ‘å€‘é‚£æ™‚åœ¨å…¬åœ’æ•£æ­¥ã€‚"},
                {q: "He ___ (not drive) fast.", a: "was not driving", t: "ä»–é‚£æ™‚æ²’é–‹å¾ˆå¿«ã€‚"}, {q: "You ___ (sing) beautifully.", a: "were singing", t: "ä½ é‚£æ™‚å”±å¾—å¾ˆç¾ã€‚"},
                {q: "It ___ (snow) last night.", a: "was snowing", t: "æ˜¨æ™šé‚£æ™‚æ­£åœ¨ä¸‹é›ªã€‚"}, {q: "I ___ (not looking) at you.", a: "was not looking", t: "æˆ‘é‚£æ™‚æ²’åœ¨çœ‹ä½ ã€‚"},
                {q: "They ___ (work) very hard.", a: "were working", t: "ä»–å€‘é‚£æ™‚åœ¨åŠªåŠ›å·¥ä½œã€‚"}, {q: "He ___ (wear) a blue coat.", a: "was wearing", t: "ä»–ç•¶æ™‚ç©¿è‘—è—å¤§è¡£ã€‚"}
            ]
        },
        futureContinuous: {
            title: "Future Continuous æœªä¾†é€²è¡Œå¼", usage: "Action in progress in the future.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>will be + ing</td></tr></table>`,
            contractions: ["will not be â†’ won't be"],
            questions: [
                {q: "I ___ (wait) for you at 5.", a: "will be waiting", t: "äº”é»æ™‚æˆ‘æœƒåœ¨é‚£ç­‰ä½ ã€‚"}, {q: "They ___ (not work) tomorrow.", a: "will not be working", t: "æ˜å¤©é€™æ™‚é–“ä»–å€‘ä¸æœƒåœ¨å·¥ä½œã€‚"},
                {q: "She ___ (fly) to London.", a: "will be flying", t: "å¥¹åˆ°æ™‚æœƒåœ¨é£›å¾€å€«æ•¦ã€‚"}, {q: "We ___ (have) lunch at 1.", a: "will be having", t: "æˆ‘å€‘ä¸€é»æ™‚æœƒæ­£åœ¨åƒåˆé¤ã€‚"},
                {q: "He ___ (not sleep) at 10 PM.", a: "will not be sleeping", t: "åé»æ™‚ä»–ä¸æœƒåœ¨ç¡è¦ºã€‚"}, {q: "You ___ (study) all night.", a: "will be studying", t: "ä½ åˆ°æ™‚æœƒè®€ä¸€æ•´æ™šæ›¸ã€‚"},
                {q: "It ___ (rain) later today.", a: "will be raining", t: "ä»Šå¤©æ™šé»æœƒæ­£åœ¨ä¸‹é›¨ã€‚"}, {q: "I ___ (not using) the car.", a: "will not be using", t: "æˆ‘åˆ°æ™‚ä¸æœƒåœ¨ä½¿ç”¨è»Šå­ã€‚"},
                {q: "They ___ (swim) soon.", a: "will be swimming", t: "ä»–å€‘å¾ˆå¿«å°±æœƒåœ¨æ¸¸æ³³ã€‚"}, {q: "She ___ (wear) a red dress.", a: "will be wearing", t: "å¥¹åˆ°æ™‚æœƒç©¿ç´…è£™å­ã€‚"}
            ]
        },
        presentPerfect: {
            title: "Present Perfect ç¾åœ¨å®Œæˆå¼", usage: "Life experience or past actions linked to now.",
            table: `<table class="rule-table"><tr><th>I/You/We/They</th><td>have + V3</td></tr><tr><th>He/She/It</th><td>has + V3</td></tr></table>`,
            contractions: ["have not â†’ haven't", "has not â†’ hasn't", "I have â†’ I've"],
            questions: [
                {q: "I ___ (see) that movie.", a: "have seen", t: "æˆ‘çœ‹éé‚£éƒ¨é›»å½±ã€‚"}, {q: "She ___ (not finish) it yet.", a: "has not finished", t: "å¥¹é‚„æ²’å®Œæˆå®ƒã€‚"},
                {q: "They ___ (live) here for 10 years.", a: "have lived", t: "ä»–å€‘ä½é€™10å¹´äº†ã€‚"}, {q: "He ___ (lose) his keys.", a: "has lost", t: "ä»–å¼„ä¸Ÿäº†é‘°åŒ™ã€‚"},
                {q: "We ___ (not meet) him before.", a: "have not met", t: "æˆ‘å€‘ä»¥å‰æ²’è¦‹éä»–ã€‚"}, {q: "You ___ (grow) since I saw you.", a: "have grown", t: "è‡ªå¾ä¸Šæ¬¡è¦‹ä½ ä½ é•·é«˜äº†ã€‚"},
                {q: "The cat ___ (eat) all its food.", a: "has eaten", t: "è²“å·²ç¶“åƒå…‰é£¼æ–™ã€‚"}, {q: "I ___ (not visit) Paris.", a: "have not visited", t: "æˆ‘é‚„æ²’å»éå·´é»ã€‚"},
                {q: "It ___ (stop) raining finally.", a: "has stopped", t: "é›¨çµ‚æ–¼åœäº†ã€‚"}, {q: "They ___ (buy) a new house.", a: "have bought", t: "ä»–å€‘è²·äº†æ–°æˆ¿ã€‚"}
            ]
        },
        pastPerfect: {
            title: "Past Perfect éå»å®Œæˆå¼", usage: "Action completed before another past action.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>had + V3 (Past Participle)</td></tr></table>`,
            contractions: ["had not â†’ hadn't", "I had â†’ I'd"],
            questions: [
                {q: "The train ___ (leave) already.", a: "had left", t: "ç«è»Šé‚£æ™‚å·²ç¶“é–‹äº†ã€‚"}, {q: "She ___ (not eat) breakfast.", a: "had not eaten", t: "å¥¹é‚£æ™‚é‚„æ²’åƒæ—©é¤ã€‚"},
                {q: "I ___ (study) hard before.", a: "had studied", t: "æˆ‘ä»¥å‰å¾ˆåŠªåŠ›è®€éæ›¸ã€‚"}, {q: "They ___ (finish) by 2 PM.", a: "had finished", t: "å…©é»å‰ä»–å€‘å°±å®Œæˆäº†ã€‚"},
                {q: "He ___ (not see) the news.", a: "had not seen", t: "ä»–é‚£æ™‚é‚„æ²’çœ‹éæ–°èã€‚"}, {q: "We ___ (clean) it already.", a: "had cleaned", t: "æˆ‘å€‘é‚£æ™‚å·²ç¶“æ‰“æƒå¥½äº†ã€‚"},
                {q: "Film ___ (start) when we arrived.", a: "had started", t: "æˆ‘å€‘åˆ°æ™‚é›»å½±å·²é–‹å§‹ã€‚"}, {q: "You ___ (not call) back.", a: "had not called", t: "ä½ é‚£æ™‚é‚„æ²’å›é›»ã€‚"},
                {q: "I ___ (lose) my way.", a: "had lost", t: "æˆ‘é‚£æ™‚è¿·è·¯äº†ã€‚"}, {q: "They ___ (prepare) a cake.", a: "had prepared", t: "ä»–å€‘é‚£æ™‚æº–å‚™äº†è›‹ç³•ã€‚"}
            ]
        },
        futurePerfect: {
            title: "Future Perfect æœªä¾†å®Œæˆå¼", usage: "Action finished by a time in the future.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>will have + V3</td></tr></table>`,
            contractions: ["will not have â†’ won't have", "I will have â†’ I'll have"],
            questions: [
                {q: "I ___ (finish) by 5 PM.", a: "will have finished", t: "äº”é»å‰æˆ‘æœƒå®Œæˆã€‚"}, {q: "She ___ (not arrive) by then.", a: "will not have arrived", t: "åœ¨é‚£ä¹‹å‰å¥¹ä¸æœƒåˆ°ã€‚"},
                {q: "They ___ (leave) soon.", a: "will have left", t: "ä»–å€‘å¾ˆå¿«å°±æœƒé›¢é–‹äº†ã€‚"}, {q: "We ___ (save) enough money.", a: "will have saved", t: "æˆ‘å€‘æœƒå­˜å¤ éŒ¢ã€‚"},
                {q: "He ___ (not graduate) yet.", a: "will not have graduated", t: "ä»–é‚£æ™‚é‚„ä¸æœƒç•¢æ¥­ã€‚"}, {q: "I ___ (buy) a house next year.", a: "will have bought", t: "æ˜å¹´æˆ‘æœƒè²·å¥½æˆ¿å­ã€‚"},
                {q: "Sun ___ (set) by 8 PM.", a: "will have set", t: "å¤ªé™½å…«é»å‰æœƒä¸‹å±±ã€‚"}, {q: "You ___ (read) the book.", a: "will have read", t: "ä½ æœƒè®€å®Œé‚£æœ¬æ›¸ã€‚"},
                {q: "They ___ (not build) it.", a: "will not have built", t: "ä»–å€‘åˆ°æ™‚é‚„ä¸æœƒè“‹å¥½ã€‚"}, {q: "Winter ___ (end) by March.", a: "will have ended", t: "ä¸‰æœˆå‰å†¬å¤©å°±æœƒçµæŸã€‚"}
            ]
        }
    };

    function clean(text) {
        if (!text) return "";
        return text.toLowerCase().trim()
            .replace(/[â€˜â€™â€œâ€]/g, "'")
            .replace(/won't/g, "will not").replace(/haven't/g, "have not")
            .replace(/hasn't/g, "has not").replace(/hadn't/g, "had not")
            .replace(/isn't/g, "is not").replace(/aren't/g, "are not")
            .replace(/wasn't/g, "was not").replace(/weren't/g, "were not")
            .replace(/n't/g, " not").replace(/'ll/g, " will")
            .replace(/[.,!?;:]/g, "").replace(/\s+/g, " ");
    }

    function goToMenu() {
        let nameInput = document.getElementById('student-name').value.trim();
        if (!nameInput) { alert("Please enter your name!"); return; }
        studentName = nameInput;
        document.getElementById('login-card').style.display = 'none';
        document.getElementById('menu-card').style.display = 'block';
        document.getElementById('global-nav').style.display = 'flex';
        document.getElementById('welcome-msg').innerText = `Welcome back, ${studentName}!`;
        
        const grid = document.getElementById('menu-buttons');
        grid.innerHTML = "";
        Object.keys(data).forEach(key => {
            const btn = document.createElement('button');
            btn.className = "lesson-btn";
            btn.innerText = data[key].title;
            btn.onclick = () => loadTense(key);
            grid.appendChild(btn);
        });
    }

    function loadTense(key) {
        currentTense = key;
        const t = data[key];
        document.getElementById('rule-content').innerHTML = `<h2>${t.title}</h2><p><b>Usage:</b> ${t.usage}</p>${t.table}`;
        document.getElementById('menu-card').style.display = 'none';
        document.getElementById('rule-card').style.display = 'block';
    }

    function toggleModal(show) {
        if (show) {
            const t = data[currentTense];
            const cList = t.contractions.map(c => `<li>${c}</li>`).join('');
            document.getElementById('modal-body').innerHTML = `<h3>${t.title}</h3>${t.table}<div style="background:#e8f0fe;padding:15px;border-radius:10px;"><b>Accepted Contractions:</b><ul>${cList}</ul></div>`;
            document.getElementById('rules-modal').style.display = 'block';
        } else { document.getElementById('rules-modal').style.display = 'none'; }
    }

    function startQuiz() {
        currentIdx = 0; userAnswers = [];
        document.getElementById('rule-card').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        showQuestion();
    }

    function showQuestion() {
        const q = data[currentTense].questions[currentIdx];
        document.getElementById('current-tense-display').innerText = data[currentTense].title;
        document.getElementById('prev-btn').style.visibility = (currentIdx > 0) ? 'visible' : 'hidden';
        document.getElementById('question-area').innerHTML = `
            <div style="display:flex; justify-content:space-between; margin-bottom: 10px;">
                <span style="font-weight:bold; color:#666;">Question ${currentIdx+1} of 10</span>
                <span onclick="toggleModal(true)" style="color:var(--primary);cursor:pointer; font-weight:bold;">ğŸ“– Rules & Tips</span>
            </div>
            <h3 style="font-size: 1.4rem;">${q.q}</h3>
            <p style="color:#666; font-style:italic;">${q.t}</p>
            <input type="text" id="ans-input" autocomplete="off" placeholder="Type answer here..." onkeypress="if(event.key==='Enter') next()">
            <button onclick="next()" style="width:100%;padding:18px;background:var(--primary);color:white;border:none;border-radius:10px;font-weight:bold;font-size:1rem;cursor:pointer;">Next Question</button>
        `;
        if (userAnswers[currentIdx]) document.getElementById('ans-input').value = userAnswers[currentIdx].user;
        document.getElementById('ans-input').focus();
    }

    function next() {
        const val = document.getElementById('ans-input').value;
        const correct = data[currentTense].questions[currentIdx].a;
        userAnswers[currentIdx] = { q: data[currentTense].questions[currentIdx].q, user: val, correct: correct, isCorrect: clean(val) === clean(correct) };
        currentIdx++;
        if (currentIdx < 10) showQuestion(); else showResults();
    }

    function prevQuestion() { if (currentIdx > 0) { currentIdx--; showQuestion(); } }

    function showResults() {
        const score = userAnswers.filter(a => a.isCorrect).length;
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('results-container').style.display = 'block';
        document.getElementById('score-summary').innerHTML = `<p style="margin:0; font-size:1.1rem; color:#666;">${studentName}</p><h1 style="font-size:4rem; margin:10px 0; color:var(--primary);">${score*10}%</h1><p style="margin:0;">Score: ${score}/10</p>`;
        
        let rev = ""; 
        userAnswers.forEach((a, i) => { 
            rev += `<div class="review-item"><b>Q${i+1}: ${a.q}</b><br>
                    <span class="${a.isCorrect?'correct-ans':'wrong-ans'}">${a.user||"(No Answer)"}</span> 
                    ${!a.isCorrect ? `| Correct: <span class="correct-ans">${a.correct}</span>` : ''}</div>`; 
        });
        document.getElementById('review-list').innerHTML = rev;
    }

    function backToHome() {
        document.querySelectorAll('.card').forEach(c => c.style.display='none');
        document.getElementById('menu-card').style.display='block';
async function saveAsPDF() {
    const { jsPDF } = window.jspdf;
    const canvas = await html2canvas(document.getElementById('capture-area'), {
        scale: 2, // Higher quality
        useCORS: true // Helps load the logo image correctly
    });
    
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p', 'mm', 'a4');
    
    // Calculate dimensions to fit the PDF page
    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
    
    pdf.addImage(imgData, 'PNG', 0, 10, pdfWidth, pdfHeight);
    pdf.save(`${studentName}_English_Result.pdf`);
}
</script>
</body>
</html>
