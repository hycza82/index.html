<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andrew's English | Online Classroom</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #1a73e8; --success: #2d8a57; --error: #c53030; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 850px; position: relative; padding-bottom: 100px; }
        .school-header { text-align: center; margin-bottom: 20px; }
        .school-logo { max-width: 300px; height: auto; }
        .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee; margin-bottom: 20px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        @media (max-width: 700px) { .menu-grid { grid-template-columns: 1fr 1fr; } }
        .lesson-btn { padding: 15px; border: none; background: var(--primary); color: white; border-radius: 10px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .lesson-btn:hover { background: #1557b0; }
        .nav-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 850px; display: flex; justify-content: space-between; z-index: 1000; }
        .home-btn { background: #444; color: white; border: none; padding: 12px 20px; border-radius: 30px; cursor: pointer; }
        .prev-btn-nav { background: white; color: #444; border: 1px solid #ddd; padding: 12px 20px; border-radius: 30px; cursor: pointer; visibility: hidden; }
        .tense-header-bar { background: var(--primary); color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-weight: bold; }
        .rule-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .rule-table th, .rule-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .rule-table th { background: #f1f3f4; color: var(--primary); }
        input[type="text"] { width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 20px; }
        #rules-modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
        .modal-content { background: white; margin: 5% auto; padding: 30px; width: 90%; max-width: 600px; border-radius: 16px; position: relative; max-height: 85vh; overflow-y: auto; }
        .close-modal { position: absolute; right: 20px; top: 10px; font-size: 28px; cursor: pointer; }
        .review-item { border-bottom: 1px solid #eee; padding: 10px 0; }
        .correct-ans { color: var(--success); font-weight: bold; }
        .wrong-ans { color: var(--error); text-decoration: line-through; margin-right: 10px; }
    </style>
</head>
<body>

<div id="rules-modal"><div class="modal-content"><span class="close-modal" onclick="toggleModal(false)">&times;</span><div id="modal-body"></div></div></div>

<div class="app-container">
    <header class="school-header"><img src="logo.png" alt="Andrew's English" class="school-logo"></header>

    <div id="login-card" class="card">
        <h2 style="text-align:center;">Student's Name <span style="font-size: 0.8rem; color:#666;">å­¸ç”Ÿå§“å</span></h2>
        <input type="text" id="student-name" placeholder="Enter your name">
        <button style="width:100%; background:var(--primary); color:white; padding:15px; border-radius:8px; border:none; font-weight:bold; cursor:pointer;" onclick="goToMenu()">Enter Classroom</button>
    </div>

    <div id="menu-card" class="card" style="display:none;">
        <h3 id="welcome-msg" style="color: var(--primary); text-align: center;"></h3>
        <div class="menu-grid" id="menu-buttons"></div>
    </div>

    <div id="rule-card" class="card" style="display:none;">
        <div id="rule-content"></div>
        <button style="width:100%; background: var(--success); color:white; padding:15px; border:none; border-radius:8px; font-weight:bold; cursor:pointer;" onclick="startQuiz()">Start Quiz</button>
    </div>

    <div id="quiz-container" class="card" style="display:none;">
        <div id="current-tense-display" class="tense-header-bar"></div>
        <div id="question-area"></div>
    </div>

    <div id="results-container" class="card" style="display:none;">
        <div id="capture-area">
            <h2 style="text-align:center;">Report Card</h2>
            <div id="score-summary" style="text-align:center; border: 2px dashed #ddd; padding: 20px; margin-bottom: 20px;"></div>
        </div>
        <button style="background:#ff9800; color:white; width:100%; padding:15px; border:none; border-radius:8px; cursor:pointer; margin-bottom:20px;" onclick="saveAsJpeg()">ğŸ“¸ Save Result</button>
        <div id="review-list"></div>
    </div>

    <div id="global-nav" class="nav-container" style="display:none;">
        <button class="home-btn" onclick="backToHome()">ğŸ  Home</button>
        <button id="prev-btn" class="prev-btn-nav" onclick="prevQuestion()">â¬… Previous</button>
    </div>
</div>

<script>
    let studentName = "", currentTense = "", currentIdx = 0, userAnswers = [];

    const data = {
        presentSimple: {
            title: "Present Simple ç¾åœ¨ç°¡å–®å¼", usage: "Habits and facts.",
            table: `<table class="rule-table"><tr><th>I/You/We/They</th><td>Verb</td></tr><tr><th>He/She/It</th><td>Verb + s/es</td></tr></table>`,
            contractions: ["do not â†’ don't", "does not â†’ doesn't"],
            questions: [{q: "He ___ (drink) milk.", a: "drinks", t: "ä»–å–ç‰›å¥¶ã€‚"}, {q: "They ___ (not like) apples.", a: "do not like", t: "ä»–å€‘ä¸å–œæ­¡ã€‚"}, {q: "She ___ (study) English.", a: "studies", t: "å¥¹å­¸è‹±æ–‡ã€‚"}, {q: "I ___ (not play) soccer.", a: "do not play", t: "æˆ‘ä¸è¸¢çƒã€‚"}, {q: "The cat ___ (sleep) a lot.", a: "sleeps", t: "è²“ç¡å¾ˆå¤šã€‚"}, {q: "Water ___ (boil) at 100Â°C.", a: "boils", t: "æ°´æœƒæ²¸é¨°ã€‚"}, {q: "We ___ (not live) here.", a: "do not live", t: "æˆ‘å€‘ä¸ä½é€™ã€‚"}, {q: "He ___ (wash) his car.", a: "washes", t: "ä»–æ´—è»Šã€‚"}, {q: "You ___ (not speak) French.", a: "do not speak", t: "ä½ ä¸èªªæ³•èªã€‚"}, {q: "Sun ___ (rise) in the east.", a: "rises", t: "å¤ªé™½å‡èµ·ã€‚"}]
        },
        pastSimple: {
            title: "Past Simple éå»ç°¡å–®å¼", usage: "Finished actions.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>V2 (ed/irregular)</td></tr><tr><th>Negative</th><td>did not + V1</td></tr></table>`,
            contractions: ["did not â†’ didn't"],
            questions: [{q: "I ___ (visit) Japan.", a: "visited", t: "æˆ‘å»äº†æ—¥æœ¬ã€‚"}, {q: "They ___ (not go) home.", a: "did not go", t: "ä»–å€‘æ²’å›å®¶ã€‚"}, {q: "She ___ (see) a movie.", a: "saw", t: "å¥¹çœ‹äº†é›»å½±ã€‚"}, {q: "He ___ (not eat) lunch.", a: "did not eat", t: "ä»–æ²’åƒåˆé¤ã€‚"}, {q: "We ___ (play) tennis.", a: "played", t: "æˆ‘å€‘æ‰“çƒã€‚"}, {q: "I ___ (buy) a phone.", a: "bought", t: "æˆ‘è²·äº†æ‰‹æ©Ÿã€‚"}, {q: "You ___ (not call) me.", a: "did not call", t: "ä½ æ²’æ‰“çµ¦æˆ‘ã€‚"}, {q: "It ___ (rain) yesterday.", a: "rained", t: "æ˜¨å¤©ä¸‹äº†é›¨ã€‚"}, {q: "They ___ (finish) late.", a: "finished", t: "ä»–å€‘æ™šçµæŸã€‚"}, {q: "She ___ (lost) her bag.", a: "lost", t: "å¥¹ä¸Ÿäº†åŒ…ã€‚"}]
        },
        futureSimple: {
            title: "Future Simple æœªä¾†ç°¡å–®å¼", usage: "Future plans.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>will + V1</td></tr><tr><th>Negative</th><td>will not + V1</td></tr></table>`,
            contractions: ["will not â†’ won't", "I will â†’ I'll"],
            questions: [{q: "I ___ (help) you.", a: "will help", t: "æˆ‘æœƒå¹«ä½ ã€‚"}, {q: "They ___ (not come).", a: "will not come", t: "ä»–å€‘ä¸æœƒä¾†ã€‚"}, {q: "She ___ (travel) soon.", a: "will travel", t: "å¥¹æœƒå»æ—…è¡Œã€‚"}, {q: "We ___ (not forget) it.", a: "will not forget", t: "æˆ‘å€‘ä¸æœƒå¿˜ã€‚"}, {q: "He ___ (buy) a car.", a: "will buy", t: "ä»–æœƒè²·è»Šã€‚"}, {q: "It ___ (be) cold.", a: "will be", t: "æœƒè®Šå†·ã€‚"}, {q: "You ___ (love) this.", a: "will love", t: "ä½ æœƒå–œæ­¡ã€‚"}, {q: "I ___ (not watch) TV.", a: "will not watch", t: "æˆ‘ä¸æœƒçœ‹ã€‚"}, {q: "They ___ (win).", a: "will win", t: "ä»–å€‘æœƒè´ã€‚"}, {q: "She ___ (not call).", a: "will not call", t: "å¥¹ä¸æœƒæ‰“ã€‚"}]
        },
        presentContinuous: {
            title: "Present Continuous ç¾åœ¨é€²è¡Œå¼", usage: "Now.",
            table: `<table class="rule-table"><tr><th>I</th><td>am + ing</td></tr><tr><th>He/She/It</th><td>is + ing</td></tr><tr><th>You/We/They</th><td>are + ing</td></tr></table>`,
            contractions: ["is not â†’ isn't", "are not â†’ aren't"],
            questions: [{q: "I ___ (read) now.", a: "am reading", t: "æ­£åœ¨è®€ã€‚"}, {q: "They ___ (not dance).", a: "are not dancing", t: "æ²’è·³èˆã€‚"}, {q: "She ___ (cook) now.", a: "is cooking", t: "æ­£åœ¨ç…®ã€‚"}, {q: "We ___ (not watch) TV.", a: "are not watching", t: "æ²’åœ¨çœ‹ã€‚"}, {q: "You ___ (listen) to me.", a: "are listening", t: "åœ¨è½æˆ‘èªªã€‚"}, {q: "He ___ (not work).", a: "is not working", t: "æ²’å·¥ä½œã€‚"}, {q: "Dog ___ (bark).", a: "is barking", t: "ç‹—åœ¨å«ã€‚"}, {q: "I ___ (not cry).", a: "am not crying", t: "æˆ‘æ²’å“­ã€‚"}, {q: "They ___ (play) now.", a: "are playing", t: "åœ¨ç©ã€‚"}, {q: "It ___ (get) dark.", a: "is getting", t: "å¤©é»‘äº†ã€‚"}]
        },
        pastContinuous: {
            title: "Past Continuous éå»é€²è¡Œå¼", usage: "Was happening.",
            table: `<table class="rule-table"><tr><th>I/He/She/It</th><td>was + ing</td></tr><tr><th>You/We/They</th><td>were + ing</td></tr></table>`,
            contractions: ["was not â†’ wasn't", "were not â†’ weren't"],
            questions: [{q: "I ___ (eat) at 7.", a: "was eating", t: "ä¸ƒé»æ™‚åœ¨åƒã€‚"}, {q: "They ___ (not study).", a: "were not studying", t: "æ²’è®€æ›¸ã€‚"}, {q: "She ___ (sleep).", a: "was sleeping", t: "åœ¨ç¡è¦ºã€‚"}, {q: "We ___ (walk).", a: "were walking", t: "åœ¨èµ°è·¯ã€‚"}, {q: "He ___ (not drive).", a: "was not driving", t: "æ²’é–‹è»Šã€‚"}, {q: "You ___ (sing).", a: "were singing", t: "åœ¨å”±æ­Œã€‚"}, {q: "It ___ (snow).", a: "was snowing", t: "åœ¨ä¸‹é›ªã€‚"}, {q: "I ___ (not look).", a: "was not looking", t: "æ²’åœ¨çœ‹ã€‚"}, {q: "They ___ (work).", a: "were working", t: "åœ¨å·¥ä½œã€‚"}, {q: "He ___ (wear) a hat.", a: "was wearing", t: "æˆ´è‘—å¸½å­ã€‚"}]
        },
        futureContinuous: {
            title: "Future Continuous æœªä¾†é€²è¡Œå¼", usage: "Will be happening.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>will be + ing</td></tr></table>`,
            contractions: ["will not be â†’ won't be"],
            questions: [{q: "I ___ (wait) for you.", a: "will be waiting", t: "æœƒåœ¨é‚£ç­‰ä½ ã€‚"}, {q: "They ___ (not work).", a: "will not be working", t: "ä¸æœƒåœ¨å·¥ä½œã€‚"}, {q: "She ___ (fly) tonight.", a: "will be flying", t: "åœ¨é£›ã€‚"}, {q: "We ___ (have) lunch.", a: "will be having", t: "åœ¨åƒåˆé¤ã€‚"}, {q: "He ___ (not sleep).", a: "will not be sleeping", t: "æ²’ç¡è¦ºã€‚"}, {q: "You ___ (study).", a: "will be studying", t: "åœ¨è®€æ›¸ã€‚"}, {q: "It ___ (rain) later.", a: "will be raining", t: "åœ¨ä¸‹é›¨ã€‚"}, {q: "I ___ (not using) it.", a: "will not be using", t: "æ²’åœ¨ç”¨ã€‚"}, {q: "They ___ (swim).", a: "will be swimming", t: "åœ¨æ¸¸æ³³ã€‚"}, {q: "She ___ (wear) red.", a: "will be wearing", t: "ç©¿ç´…è‰²ã€‚"}]
        },
        presentPerfect: {
            title: "Present Perfect ç¾åœ¨å®Œæˆå¼", usage: "Up to now.",
            table: `<table class="rule-table"><tr><th>I/You/We/They</th><td>have + V3</td></tr><tr><th>He/She/It</th><td>has + V3</td></tr></table>`,
            contractions: ["have not â†’ haven't", "has not â†’ hasn't"],
            questions: [{q: "I ___ (see) it.", a: "have seen", t: "çœ‹éäº†ã€‚"}, {q: "She ___ (not finish).", a: "has not finished", t: "æ²’å®Œæˆã€‚"}, {q: "They ___ (live) here.", a: "have lived", t: "ä½é€™ã€‚"}, {q: "He ___ (lose) keys.", a: "has lost", t: "ä¸Ÿé‘°åŒ™ã€‚"}, {q: "We ___ (not meet).", a: "have not met", t: "æ²’è¦‹éã€‚"}, {q: "You ___ (grow).", a: "have grown", t: "é•·é«˜ã€‚"}, {q: "Cat ___ (eat).", a: "has eaten", t: "åƒäº†ã€‚"}, {q: "I ___ (not visit).", a: "have not visited", t: "æ²’å»éã€‚"}, {q: "It ___ (stop) raining.", a: "has stopped", t: "é›¨åœã€‚"}, {q: "They ___ (buy) a car.", a: "have bought", t: "è²·è»Šã€‚"}]
        },
        pastPerfect: {
            title: "Past Perfect éå»å®Œæˆå¼", usage: "Before then.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>had + V3</td></tr></table>`,
            contractions: ["had not â†’ hadn't"],
            questions: [{q: "Train ___ (leave).", a: "had left", t: "ç«è»Šé–‹äº†ã€‚"}, {q: "She ___ (not eat).", a: "had not eaten", t: "æ²’åƒã€‚"}, {q: "I ___ (study) hard.", a: "had studied", t: "å­¸éã€‚"}, {q: "They ___ (finish) lunch.", a: "had finished", t: "åƒå®Œåˆé¤ã€‚"}, {q: "He ___ (not see) me.", a: "had not seen", t: "æ²’çœ‹è¦‹ã€‚"}, {q: "We ___ (clean) it.", a: "had cleaned", t: "æ‰“æƒäº†ã€‚"}, {q: "Film ___ (start).", a: "had started", t: "é–‹å§‹äº†ã€‚"}, {q: "You ___ (not call).", a: "had not called", t: "æ²’æ‰“ä¾†ã€‚"}, {q: "I ___ (lose) it.", a: "had lost", t: "ä¸Ÿäº†ã€‚"}, {q: "They ___ (prepare).", a: "had prepared", t: "æº–å‚™äº†ã€‚"}]
        },
        futurePerfect: {
            title: "Future Perfect æœªä¾†å®Œæˆå¼", usage: "Done by then.",
            table: `<table class="rule-table"><tr><th>All Subjects</th><td>will have + V3</td></tr></table>`,
            contractions: ["will not have â†’ won't have"],
            questions: [{q: "I ___ (finish) by 5.", a: "will have finished", t: "äº”é»å‰æœƒå®Œæˆã€‚"}, {q: "She ___ (not arrive).", a: "will not have arrived", t: "æ²’æŠµé”ã€‚"}, {q: "They ___ (leave) soon.", a: "will have left", t: "é›¢é–‹äº†ã€‚"}, {q: "We ___ (save) money.", a: "will have saved", t: "å­˜éŒ¢äº†ã€‚"}, {q: "He ___ (not graduate).", a: "will not have graduated", t: "æ²’ç•¢æ¥­ã€‚"}, {q: "I ___ (buy) a house.", a: "will have bought", t: "è²·æˆ¿ã€‚"}, {q: "Sun ___ (set) by 8.", a: "will have set", t: "æ—¥è½ã€‚"}, {q: "You ___ (read) it all.", a: "will have read", t: "è®€å®Œã€‚"}, {q: "They ___ (not build) it.", a: "will not have built", t: "æ²’è“‹ã€‚"}, {q: "Winter ___ (end).", a: "will have ended", t: "å†¬å¤©çµæŸã€‚"}]
        }
    };

    function clean(text) {
        if (!text) return "";
        return text.toLowerCase().trim()
            .replace(/[â€˜â€™â€œâ€]/g, "'")
            .replace(/won't/g, "will not").replace(/haven't/g, "have not")
            .replace(/hasn't/g, "has not").replace(/hadn't/g, "had not")
            .replace(/isn't/g, "is not").replace(/aren't/g, "are not")
            .replace(/n't/g, " not").replace(/'ll/g, " will")
            .replace(/[.,!?;:]/g, "").replace(/\s+/g, " ");
    }

    function goToMenu() {
        let nameInput = document.getElementById('student-name').value.trim();
        if (!nameInput) return;
        studentName = nameInput;
        document.getElementById('login-card').style.display = 'none';
        document.getElementById('menu-card').style.display = 'block';
        document.getElementById('global-nav').style.display = 'flex';
        document.getElementById('welcome-msg').innerText = `Hello, ${studentName}!`;
        
        let grid = document.getElementById('menu-buttons');
        grid.innerHTML = "";
        Object.keys(data).forEach(key => {
            grid.innerHTML += `<button class="lesson-btn" onclick="loadTense('${key}')">${data[key].title.split(' ')[0]} ${data[key].title.split(' ')[1]}</button>`;
        });
    }

    function loadTense(key) {
        currentTense = key;
        let t = data[key];
        document.getElementById('rule-content').innerHTML = `<h2>${t.title}</h2><p>${t.usage}</p>${t.table}`;
        document.getElementById('menu-card').style.display = 'none';
        document.getElementById('rule-card').style.display = 'block';
    }

    function toggleModal(show) {
        if (show) {
            let t = data[currentTense];
            let list = t.contractions.map(c => `<li>${c}</li>`).join('');
            document.getElementById('modal-body').innerHTML = `<h3>${t.title}</h3>${t.table}<div style="background:#e8f0fe;padding:15px;margin-top:10px;"><b>Contractions:</b><ul>${list}</ul></div>`;
            document.getElementById('rules-modal').style.display = 'block';
        } else { document.getElementById('rules-modal').style.display = 'none'; }
    }

    function startQuiz() {
        currentIdx = 0; userAnswers = [];
        document.getElementById('rule-card').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        showQuestion();
    }

    function showQuestion() {
        let q = data[currentTense].questions[currentIdx];
        document.getElementById('current-tense-display').innerText = data[currentTense].title;
        document.getElementById('prev-btn').style.visibility = (currentIdx > 0) ? 'visible' : 'hidden';
        document.getElementById('question-area').innerHTML = `
            <div style="display:flex; justify-content:space-between;"><span>${currentIdx+1}/10</span><span onclick="toggleModal(true)" style="color:var(--primary);cursor:pointer;">ğŸ“– Rules</span></div>
            <h3>${q.q}</h3><p>${q.t}</p>
            <input type="text" id="ans-input" autocomplete="off" onkeypress="if(event.key==='Enter') next()">
            <button onclick="next()" style="width:100%;padding:15px;background:var(--primary);color:white;border:none;border-radius:8px;">Next</button>`;
        if (userAnswers[currentIdx]) document.getElementById('ans-input').value = userAnswers[currentIdx].user;
        document.getElementById('ans-input').focus();
    }

    function next() {
        let val = document.getElementById('ans-input').value;
        let correct = data[currentTense].questions[currentIdx].a;
        userAnswers[currentIdx] = { q: data[currentTense].questions[currentIdx].q, user: val, correct: correct, isCorrect: clean(val) === clean(correct) };
        currentIdx++;
        if (currentIdx < 10) showQuestion(); else showResults();
    }

    function prevQuestion() { if (currentIdx > 0) { currentIdx--; showQuestion(); } }

    function showResults() {
        let score = userAnswers.filter(a => a.isCorrect).length;
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('results-container').style.display = 'block';
        document.getElementById('score-summary').innerHTML = `<h3>${studentName}</h3><h1>${score*10}%</h1>`;
        let rev = ""; userAnswers.forEach(a => { rev += `<div class="review-item"><b>${a.q}</b><br>Yours: <span class="${a.isCorrect?'correct-ans':'wrong-ans'}">${a.user||"None"}</span> | Ans: ${a.correct}</div>`; });
        document.getElementById('review-list').innerHTML = rev;
    }

    function backToHome() {
        document.querySelectorAll('.card').forEach(c => c.style.display='none');
        document.getElementById('menu-card').style.display='block';
    }

    function saveAsJpeg() {
        html2canvas(document.getElementById('capture-area')).then(canvas => {
            const img = canvas.toDataURL('image/jpeg');
            const win = window.open();
            win.document.write(`<img src="${img}" style="width:100%;">`);
        });
    }
</script>
</body>
</html>
